<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommate COO Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dashboard-header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .dashboard-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group label {
            font-weight: 600;
            color: #2d3748;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-group button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .filter-group button:hover {
            background: #5568d3;
        }

        .filter-info {
            width: 100%;
            padding: 10px;
            background: #edf2f7;
            border-radius: 6px;
            font-size: 14px;
            color: #4a5568;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tab:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert-banner {
            background: #fed7d7;
            border-left: 4px solid #f56565;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-banner h2 {
            color: #c53030;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .alert-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .alert-item:last-child {
            margin-bottom: 0;
        }

        .success-banner {
            background: #c6f6d5;
            border-left: 4px solid #48bb78;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .success-banner h2 {
            color: #2f855a;
            font-size: 24px;
        }

        .team-section {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .team-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2d3748;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .summary-card.green { border-left-color: #48bb78; }
        .summary-card.yellow { border-left-color: #ecc94b; }
        .summary-card.red { border-left-color: #f56565; }

        .summary-card-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
        }

        .summary-card-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            text-align: left;
            padding: 12px;
            background: #f7fafc;
            font-size: 13px;
            color: #718096;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .status-green { color: #48bb78; font-weight: 600; }
        .status-yellow { color: #ecc94b; font-weight: 600; }
        .status-red { color: #f56565; font-weight: 600; }
        .status-blue { color: #4299e1; font-weight: 600; }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <h1>üìä Ecommate COO Dashboard</h1>
        <p>Real-time Operations Monitoring ‚Ä¢ Fully Dynamic</p>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label>üìÖ From:</label>
            <input type="date" id="dateFrom">
        </div>
        <div class="filter-group">
            <label>To:</label>
            <input type="date" id="dateTo">
        </div>
        <div class="filter-group">
            <button onclick="applyFilters()">Apply Filter</button>
            <button onclick="showAll()">Show All</button>
            <button onclick="refreshData()" style="background: #48bb78;">üîÑ Refresh</button>
        </div>
        <div class="filter-group">
            <label>üè¢ Branch:</label>
            <select id="branchFilter" onchange="applyFilters()">
                <option value="">All Branches</option>
            </select>
        </div>
        <div class="filter-info" id="filterInfo">Showing all data</div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showTab('red-flags')">üö® Red Flags</div>
        <div class="tab" onclick="showTab('cs')">üìû CS Team</div>
        <div class="tab" onclick="showTab('disputes')">‚öñÔ∏è Disputes</div>
        <div class="tab" onclick="showTab('creative')">‚úçÔ∏è Creative Strategist</div>
        <div class="tab" onclick="showTab('video')">üé¨ Video Editors</div>
        <div class="tab" onclick="showTab('campaigns')">üìß Campaigns</div>
        <div class="tab" onclick="showTab('funnels')">üéØ Funnels</div>
        <div class="tab" onclick="showTab('hiring')">üë• Hiring</div>
        <div class="tab" onclick="showTab('coo-tasks')">üìã COO Tasks</div>
        <div class="tab" onclick="showTab('weekly')">üìù Weekly Updates</div>
    </div>

    <div id="red-flags" class="tab-content active"></div>
    <div id="cs" class="tab-content"></div>
    <div id="disputes" class="tab-content"></div>
    <div id="creative" class="tab-content"></div>
    <div id="video" class="tab-content"></div>
    <div id="campaigns" class="tab-content"></div>
    <div id="funnels" class="tab-content"></div>
    <div id="hiring" class="tab-content"></div>
    <div id="coo-tasks" class="tab-content"></div>
    <div id="weekly" class="tab-content"></div>

    <script>
        // ==================== CONFIGURATION ====================
        // UPDATE THIS WITH YOUR GOOGLE SHEET ID
        const GOOGLE_SHEETS_ID = '1mDLav3tCDpttHdzEmJPdZAy6SXD-01izI9LyzrDSW9Q';
        
        // Sheet names - UPDATE THESE TO MATCH YOUR SHEET TAB NAMES
        const SHEET_NAMES = {
            cs: 'CS Team',
            disputes: 'Disputes',
            creative: 'Creative Strategist',
            video: 'Video Editors',
            campaigns: 'Campaigns',
            funnels: 'Funnels',
            hiring: 'Hiring',
            cooTasks: 'COO Tasks',
            weekly: 'Weekly Updates',
            redFlags: 'Red Flags'
        };

        // Severity weights for campaigns/funnels
        const SEVERITY_WEIGHTS = {
            'Minimal': 1,
            'Major': 2,
            'Critical': 3
        };

        // ==================== DATA STORAGE ====================
        let dashboardData = {};
        let currentFilters = { dateFrom: null, dateTo: null, branch: '' };

        // ==================== INITIALIZATION ====================
        function initDates() {
            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            
            document.getElementById('dateFrom').valueAsDate = weekAgo;
            document.getElementById('dateTo').valueAsDate = today;
        }

        // ==================== DATE UTILITIES ====================
        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            if (dateStr.toString().includes('Date(')) {
                const match = dateStr.match(/Date\((\d+),(\d+),(\d+)\)/);
                if (match) {
                    return new Date(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]));
                }
            }
            
            if (!isNaN(dateStr) && dateStr > 40000 && dateStr < 60000) {
                return new Date((dateStr - 25569) * 86400 * 1000);
            }
            
            const parsed = new Date(dateStr);
            return isNaN(parsed.getTime()) ? null : parsed;
        }

        function formatDate(dateStr) {
            const date = parseDate(dateStr);
            if (!date) return dateStr;
            return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
        }

        function formatDuration(value) {
            if (!value && value !== 0) return '';
            
            // Already formatted as HH:MM:SS string
            if (typeof value === 'string' && value.includes(':')) return value;
            if (typeof value === 'string' && value.trim() === '') return '';
            
            // Handle Google Sheets Date object format: Date(1899,11,30,17,0,34)
            if (value && typeof value === 'string' && value.includes('Date(')) {
                const match = value.match(/Date\((\d+),(\d+),(\d+),(\d+),(\d+),(\d+)\)/);
                if (match) {
                    const hours = parseInt(match[4]);
                    const minutes = parseInt(match[5]);
                    const seconds = parseInt(match[6]);
                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }
            
            const num = parseFloat(value);
            if (isNaN(num)) return '';
            
            // Convert decimal days to HH:MM:SS
            const totalSeconds = Math.round(num * 24 * 60 * 60);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // ==================== FILTERING ====================
        function filterData(data) {
            if (!data || data.length === 0) return [];
            
            return data.filter(row => {
                if (currentFilters.dateFrom || currentFilters.dateTo) {
                    const rowDate = parseDate(row.Date || row.date);
                    if (!rowDate) return false;
                    
                    if (currentFilters.dateFrom && rowDate < currentFilters.dateFrom) return false;
                    if (currentFilters.dateTo && rowDate > currentFilters.dateTo) return false;
                }
                
                if (currentFilters.branch) {
                    const rowBranch = row.Branch || row.branch || '';
                    if (rowBranch && rowBranch !== currentFilters.branch) return false;
                }
                
                return true;
            });
        }

        function applyFilters() {
            const fromDate = document.getElementById('dateFrom').valueAsDate;
            const toDate = document.getElementById('dateTo').valueAsDate;
            const branch = document.getElementById('branchFilter').value;
            
            currentFilters.dateFrom = fromDate;
            currentFilters.dateTo = toDate ? new Date(toDate.getTime() + 86400000) : null;
            currentFilters.branch = branch;
            
            let info = [];
            if (fromDate) info.push(`From: ${formatDate(fromDate)}`);
            if (toDate) info.push(`To: ${formatDate(toDate)}`);
            if (branch) info.push(`Branch: ${branch}`);
            
            document.getElementById('filterInfo').textContent = info.length > 0 ? info.join(' | ') : 'Showing all data';
            
            renderAll();
        }

        function showAll() {
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('branchFilter').value = '';
            currentFilters = { dateFrom: null, dateTo: null, branch: '' };
            document.getElementById('filterInfo').textContent = 'Showing all data';
            renderAll();
        }

        function populateBranchFilter() {
            const branches = new Set();
            
            ['creative', 'video', 'disputes'].forEach(key => {
                (dashboardData[key] || []).forEach(row => {
                    const branch = row.Branch || row.branch;
                    if (branch) branches.add(branch);
                });
            });
            
            const select = document.getElementById('branchFilter');
            select.innerHTML = '<option value="">All Branches</option>';
            
            Array.from(branches).sort().forEach(branch => {
                const option = document.createElement('option');
                option.value = branch;
                option.textContent = branch;
                select.appendChild(option);
            });
        }

        // ==================== TAB NAVIGATION ====================
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // ==================== DATA LOADING ====================
        async function fetchSheetData(sheetName) {
            const url = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                if (!json.table || !json.table.rows) return [];
                
                const headers = json.table.cols.map(col => col.label || '');
                
                return json.table.rows.map(row => {
                    const obj = {};
                    row.c.forEach((cell, i) => {
                        if (headers[i]) {
                            // Use formatted value (f) if available, otherwise use raw value (v)
                            if (cell) {
                                obj[headers[i]] = cell.f !== undefined && cell.f !== null ? cell.f : (cell.v !== null ? cell.v : '');
                            } else {
                                obj[headers[i]] = '';
                            }
                        }
                    });
                    return obj;
                }).filter(row => Object.values(row).some(v => v !== ''));
            } catch (error) {
                console.error(`Error fetching ${sheetName}:`, error);
                return [];
            }
        }

        async function loadAllData() {
            const loadingHtml = '<div class="loading">Loading data...</div>';
            document.querySelectorAll('.tab-content').forEach(c => c.innerHTML = loadingHtml);
            
            const promises = Object.entries(SHEET_NAMES).map(async ([key, name]) => {
                dashboardData[key] = await fetchSheetData(name);
            });
            
            await Promise.all(promises);
            
            populateBranchFilter();
            renderAll();
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderAll() {
            renderRedFlags();
            renderCS();
            renderDisputes();
            renderCreative();
            renderVideo();
            renderCampaigns();
            renderFunnels();
            renderHiring();
            renderCOOTasks();
            renderWeekly();
        }

        // ==================== RED FLAGS ====================
        function renderRedFlags() {
            const container = document.getElementById('red-flags');
            const alerts = [];
            
            // Manual Red Flags from Red Flags sheet
            const manualRedFlags = filterData(dashboardData.redFlags || []);
            manualRedFlags.forEach(row => {
                alerts.push({
                    team: row.Category || 'General',
                    person: row.Title || '',
                    issue: `${row.Description || ''}<br><strong>Details:</strong> ${row.Details || '-'}<br><strong>Action:</strong> ${row.Action || '-'}`,
                    date: formatDate(row.Date || row.date),
                    isManual: true
                });
            });
            
            // CS Underperformers
            const csData = filterData(dashboardData.cs || []);
            csData.forEach(row => {
                if (row.Status && row.Status.includes('Underperformer')) {
                    alerts.push({
                        team: 'CS Team',
                        person: row.Name || row.name,
                        issue: `Underperforming - ${row['Messages Sent'] || 0} messages (Target: ${row.Target || 'N/A'})`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // Disputes Underperformers
            const disputeData = filterData(dashboardData.disputes || []);
            disputeData.forEach(row => {
                if (row.Status && row.Status.includes('Underperformer')) {
                    alerts.push({
                        team: 'Disputes',
                        person: row.Handler || row.Name || row.name,
                        issue: `Underperforming - ${row['Responded Today'] || 0} responded (Target: ${row.Target || 'N/A'})`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // Creative Strategist Underperformers
            const creativeData = filterData(dashboardData.creative || []);
            creativeData.forEach(row => {
                if (row.Status && row.Status.includes('Underperformer')) {
                    alerts.push({
                        team: 'Creative Strategist',
                        person: row.Name || row.name,
                        issue: `Underperforming - ${row['Scripts Created'] || 0} scripts (Target: ${row.Target || 'N/A'})`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // Video Editor Underperformers
            const videoData = filterData(dashboardData.video || []);
            videoData.forEach(row => {
                if (row.Status && row.Status.includes('Underperformer')) {
                    alerts.push({
                        team: 'Video Editors',
                        person: row.Name || row.name,
                        issue: `Underperforming - ${row.Videos || 0} videos, ${row.Images || 0} images`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // Campaign Errors (Critical)
            const campaignData = filterData(dashboardData.campaigns || []);
            campaignData.forEach(row => {
                if (row['Error Severity'] === 'Critical') {
                    alerts.push({
                        team: 'Campaigns',
                        person: row.Name || row.name,
                        issue: `Critical Error on ${row['Campaign Name']}: ${row['Error Details'] || 'No details'}`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // Funnel Errors (Critical) or Not Completed
            const funnelData = filterData(dashboardData.funnels || []);
            funnelData.forEach(row => {
                if (row['Error Severity'] === 'Critical') {
                    alerts.push({
                        team: 'Funnels',
                        person: row.Name || row.name,
                        issue: `Critical Error on ${row['Funnel Name']}: ${row['Error Details'] || 'No details'}`,
                        date: formatDate(row.Date || row.date)
                    });
                }
                if (row.Completed === 'No') {
                    alerts.push({
                        team: 'Funnels',
                        person: row.Name || row.name,
                        issue: `Funnel not completed: ${row['Funnel Name']}`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            // COO Tasks with Roadblock
            const cooData = filterData(dashboardData.cooTasks || []);
            cooData.forEach(row => {
                if (row.Status === 'Roadblock') {
                    alerts.push({
                        team: 'COO Tasks',
                        person: 'Carl',
                        issue: `Roadblock: ${row.Task} - ${row.Roadblock || 'No details'}`,
                        date: formatDate(row.Date || row.date)
                    });
                }
            });
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="success-banner">
                        <h2>‚úÖ All Clear - No Red Flags!</h2>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="alert-banner">
                    <h2>üö® ${alerts.length} Red Flag${alerts.length > 1 ? 's' : ''} Detected</h2>
            `;
            
            alerts.forEach(alert => {
                html += `
                    <div class="alert-item" ${alert.isManual ? 'style="border-left: 3px solid #e53e3e;"' : ''}>
                        <strong>${alert.team}</strong> ${alert.person ? '- ' + alert.person : ''}<br>
                        ${alert.issue}<br>
                        <small style="color: #718096;">${alert.date}</small>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // ==================== CS TEAM ====================
        function renderCS() {
            const container = document.getElementById('cs');
            const data = filterData(dashboardData.cs || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üìû CS Team</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            // Summary
            const total = data.length;
            const overperformers = data.filter(r => r.Status && r.Status.includes('Overperformer')).length;
            const expected = data.filter(r => r.Status && r.Status.includes('Expected')).length;
            const underperformers = data.filter(r => r.Status && r.Status.includes('Underperformer')).length;
            
            let html = `
                <div class="team-section">
                    <h3>üìû CS Team</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Entries</div>
                            <div class="summary-card-value">${total}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">üåü Overperformers</div>
                            <div class="summary-card-value">${overperformers}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">‚úÖ Expected</div>
                            <div class="summary-card-value">${expected}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">üî¥ Underperformers</div>
                            <div class="summary-card-value">${underperformers}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Hours Worked</th>
                                <th>Messages Sent</th>
                                <th>First Response</th>
                                <th>Avg Response</th>
                                <th>Resolution Time</th>
                                <th>Target</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status && row.Status.includes('Overperformer') ? 'status-green' : 
                                   row.Status && row.Status.includes('Underperformer') ? 'status-red' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Name || ''}</strong></td>
                        <td>${row['Hours Worked'] || ''}</td>
                        <td>${row['Messages Sent'] || ''}</td>
                        <td>${formatDuration(row['First Response Time'])}</td>
                        <td>${formatDuration(row['Average Response Time'])}</td>
                        <td>${formatDuration(row['Resolution Time'])}</td>
                        <td>${row.Target || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== DISPUTES ====================
        function renderDisputes() {
            const container = document.getElementById('disputes');
            const data = filterData(dashboardData.disputes || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>‚öñÔ∏è Disputes</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const overperformers = data.filter(r => r.Status && r.Status.includes('Overperformer')).length;
            const expected = data.filter(r => r.Status && r.Status.includes('Expected')).length;
            const underperformers = data.filter(r => r.Status && r.Status.includes('Underperformer')).length;
            
            let html = `
                <div class="team-section">
                    <h3>‚öñÔ∏è Disputes</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Entries</div>
                            <div class="summary-card-value">${data.length}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">üåü Overperformers</div>
                            <div class="summary-card-value">${overperformers}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">‚úÖ Expected</div>
                            <div class="summary-card-value">${expected}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">üî¥ Underperformers</div>
                            <div class="summary-card-value">${underperformers}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Handler</th>
                                <th>Store</th>
                                <th>Processor</th>
                                <th>Hours Worked</th>
                                <th>Responded Today</th>
                                <th>Target</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status && row.Status.includes('Overperformer') ? 'status-green' : 
                                   row.Status && row.Status.includes('Underperformer') ? 'status-red' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Handler || row.Name || ''}</strong></td>
                        <td>${row.Store || ''}</td>
                        <td>${row.Processor || ''}</td>
                        <td>${row['Hours Worked'] || ''}</td>
                        <td>${row['Responded Today'] || ''}</td>
                        <td>${row.Target || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== CREATIVE STRATEGIST ====================
        function renderCreative() {
            const container = document.getElementById('creative');
            const data = filterData(dashboardData.creative || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>‚úçÔ∏è Creative Strategist</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const overperformers = data.filter(r => r.Status && r.Status.includes('Overperformer')).length;
            const expected = data.filter(r => r.Status && r.Status.includes('Expected')).length;
            const underperformers = data.filter(r => r.Status && r.Status.includes('Underperformer')).length;
            
            let html = `
                <div class="team-section">
                    <h3>‚úçÔ∏è Creative Strategist</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Entries</div>
                            <div class="summary-card-value">${data.length}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">üåü Overperformers</div>
                            <div class="summary-card-value">${overperformers}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">‚úÖ Expected</div>
                            <div class="summary-card-value">${expected}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">üî¥ Underperformers</div>
                            <div class="summary-card-value">${underperformers}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Branch</th>
                                <th>Scripts Created</th>
                                <th>Target</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status && row.Status.includes('Overperformer') ? 'status-green' : 
                                   row.Status && row.Status.includes('Underperformer') ? 'status-red' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Name || ''}</strong></td>
                        <td>${row.Branch || ''}</td>
                        <td>${row['Scripts Created'] || ''}</td>
                        <td>${row.Target || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== VIDEO EDITORS ====================
        function renderVideo() {
            const container = document.getElementById('video');
            const data = filterData(dashboardData.video || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üé¨ Video Editors</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const overperformers = data.filter(r => r.Status && r.Status.includes('Overperformer')).length;
            const expected = data.filter(r => r.Status && r.Status.includes('Expected')).length;
            const underperformers = data.filter(r => r.Status && r.Status.includes('Underperformer')).length;
            
            let html = `
                <div class="team-section">
                    <h3>üé¨ Video Editors</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Entries</div>
                            <div class="summary-card-value">${data.length}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">üåü Overperformers</div>
                            <div class="summary-card-value">${overperformers}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">‚úÖ Expected</div>
                            <div class="summary-card-value">${expected}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">üî¥ Underperformers</div>
                            <div class="summary-card-value">${underperformers}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Branch</th>
                                <th>Videos</th>
                                <th>Images</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status && row.Status.includes('Overperformer') ? 'status-green' : 
                                   row.Status && row.Status.includes('Underperformer') ? 'status-red' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Name || ''}</strong></td>
                        <td>${row.Branch || ''}</td>
                        <td>${row.Videos || ''}</td>
                        <td>${row.Images || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== CAMPAIGNS (AGGREGATED) ====================
        function renderCampaigns() {
            const container = document.getElementById('campaigns');
            const data = filterData(dashboardData.campaigns || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üìß Campaigns</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            // Group by Date + Name + Campaign Name
            const grouped = {};
            data.forEach(row => {
                const key = `${row.Date}|${row.Name}|${row['Campaign Name']}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        Date: row.Date,
                        Name: row.Name,
                        CampaignName: row['Campaign Name'],
                        Errors: 0,
                        TotalSeverity: 0,
                        ErrorDetails: []
                    };
                }
                if (row['Error Severity']) {
                    grouped[key].Errors++;
                    grouped[key].TotalSeverity += SEVERITY_WEIGHTS[row['Error Severity']] || 0;
                    grouped[key].ErrorDetails.push(`${row['Error Severity']}: ${row['Error Details'] || 'No details'}`);
                }
            });
            
            const aggregated = Object.values(grouped);
            
            // Calculate summary by person by day
            const personDaySummary = {};
            aggregated.forEach(row => {
                const key = `${row.Date}|${row.Name}`;
                if (!personDaySummary[key]) {
                    personDaySummary[key] = { campaigns: 0, errors: 0, severity: 0 };
                }
                personDaySummary[key].campaigns++;
                personDaySummary[key].errors += row.Errors;
                personDaySummary[key].severity += row.TotalSeverity;
            });
            
            const totalCampaigns = aggregated.length;
            const totalErrors = aggregated.reduce((sum, r) => sum + r.Errors, 0);
            const criticalErrors = data.filter(r => r['Error Severity'] === 'Critical').length;
            
            let html = `
                <div class="team-section">
                    <h3>üìß Campaigns</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Campaigns</div>
                            <div class="summary-card-value">${totalCampaigns}</div>
                        </div>
                        <div class="summary-card ${totalErrors === 0 ? 'green' : 'yellow'}">
                            <div class="summary-card-label">Total Errors</div>
                            <div class="summary-card-value">${totalErrors}</div>
                        </div>
                        <div class="summary-card ${criticalErrors === 0 ? 'green' : 'red'}">
                            <div class="summary-card-label">Critical Errors</div>
                            <div class="summary-card-value">${criticalErrors}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Success Rate</div>
                            <div class="summary-card-value">${totalCampaigns > 0 ? Math.round((1 - (aggregated.reduce((sum, r) => sum + r.TotalSeverity, 0) / 100 / totalCampaigns)) * 100) : 100}%</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Campaign Name</th>
                                <th>Errors</th>
                                <th>Severity %</th>
                                <th>Error Details</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            aggregated.forEach(row => {
                const successRate = 100 - row.TotalSeverity;
                let status = 'üåü Overperformer';
                let statusClass = 'status-green';
                
                if (successRate < 95) {
                    status = 'üî¥ Underperformer';
                    statusClass = 'status-red';
                } else if (successRate < 100) {
                    status = '‚úÖ Expected';
                    statusClass = '';
                }
                
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Name || ''}</strong></td>
                        <td>${row.CampaignName || ''}</td>
                        <td>${row.Errors}</td>
                        <td>${row.TotalSeverity}%</td>
                        <td>${row.ErrorDetails.join('; ') || '-'}</td>
                        <td class="${statusClass}">${status}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== FUNNELS ====================
        function renderFunnels() {
            const container = document.getElementById('funnels');
            const data = filterData(dashboardData.funnels || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üéØ Funnels</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const completed = data.filter(r => r.Completed === 'Yes').length;
            const notCompleted = data.filter(r => r.Completed === 'No').length;
            const withErrors = data.filter(r => r['Error Severity']).length;
            
            let html = `
                <div class="team-section">
                    <h3>üéØ Funnels</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Total Funnels</div>
                            <div class="summary-card-value">${data.length}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">Completed</div>
                            <div class="summary-card-value">${completed}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">Not Completed</div>
                            <div class="summary-card-value">${notCompleted}</div>
                        </div>
                        <div class="summary-card ${withErrors === 0 ? 'green' : 'yellow'}">
                            <div class="summary-card-label">With Errors</div>
                            <div class="summary-card-value">${withErrors}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Funnel Name</th>
                                <th>Completed</th>
                                <th>Error Severity</th>
                                <th>Error Details</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const completedClass = row.Completed === 'Yes' ? 'status-green' : 'status-red';
                const severityClass = row['Error Severity'] === 'Critical' ? 'status-red' : 
                                     row['Error Severity'] === 'Major' ? 'status-yellow' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Name || ''}</strong></td>
                        <td>${row['Funnel Name'] || ''}</td>
                        <td class="${completedClass}">${row.Completed || ''}</td>
                        <td class="${severityClass}">${row['Error Severity'] || '-'}</td>
                        <td>${row['Error Details'] || '-'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== HIRING ====================
        function renderHiring() {
            const container = document.getElementById('hiring');
            const data = filterData(dashboardData.hiring || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üë• Hiring</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const totalSourced = data.reduce((sum, r) => sum + (parseInt(r.Sourced) || 0), 0);
            const totalInterviewed = data.reduce((sum, r) => sum + (parseInt(r.Interviewed) || 0), 0);
            const totalHired = data.reduce((sum, r) => sum + (parseInt(r.Hired) || 0), 0);
            const openRoles = data.filter(r => r.Status !== 'Filled').length;
            
            let html = `
                <div class="team-section">
                    <h3>üë• Hiring</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-card-label">Open Roles</div>
                            <div class="summary-card-value">${openRoles}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Total Sourced</div>
                            <div class="summary-card-value">${totalSourced}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Total Interviewed</div>
                            <div class="summary-card-value">${totalInterviewed}</div>
                        </div>
                        <div class="summary-card green">
                            <div class="summary-card-label">Total Hired</div>
                            <div class="summary-card-value">${totalHired}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Role</th>
                                <th>Sourced</th>
                                <th>Reached Out</th>
                                <th>Interviewed</th>
                                <th>Offers</th>
                                <th>Hired</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status === 'Filled' ? 'status-green' : 
                                   row.Status === 'Sourcing' ? 'status-yellow' : 'status-blue';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Role || ''}</strong></td>
                        <td>${row.Sourced || ''}</td>
                        <td>${row['Reached Out'] || ''}</td>
                        <td>${row.Interviewed || ''}</td>
                        <td>${row.Offers || ''}</td>
                        <td>${row.Hired || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== COO TASKS ====================
        function renderCOOTasks() {
            const container = document.getElementById('coo-tasks');
            const data = filterData(dashboardData.cooTasks || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üìã COO Tasks</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            const done = data.filter(r => r.Status === 'Done').length;
            const inProgress = data.filter(r => r.Status === 'In Progress').length;
            const roadblocks = data.filter(r => r.Status === 'Roadblock').length;
            const notStarted = data.filter(r => r.Status === 'Not Started').length;
            
            let html = `
                <div class="team-section">
                    <h3>üìã COO Tasks</h3>
                    <div class="summary-cards">
                        <div class="summary-card green">
                            <div class="summary-card-label">Done</div>
                            <div class="summary-card-value">${done}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">In Progress</div>
                            <div class="summary-card-value">${inProgress}</div>
                        </div>
                        <div class="summary-card red">
                            <div class="summary-card-label">Roadblocks</div>
                            <div class="summary-card-value">${roadblocks}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Not Started</div>
                            <div class="summary-card-value">${notStarted}</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Task</th>
                                <th>Breakdown</th>
                                <th>Status</th>
                                <th>Roadblock</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                const statusClass = row.Status === 'Done' ? 'status-green' : 
                                   row.Status === 'Roadblock' ? 'status-red' : 
                                   row.Status === 'In Progress' ? 'status-blue' : '';
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Task || ''}</strong></td>
                        <td>${row['Breakdown of Task'] || ''}</td>
                        <td class="${statusClass}">${row.Status || ''}</td>
                        <td>${row.Roadblock || '-'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== WEEKLY UPDATES ====================
        function renderWeekly() {
            const container = document.getElementById('weekly');
            const data = filterData(dashboardData.weekly || []);
            
            if (data.length === 0) {
                container.innerHTML = '<div class="team-section"><h3>üìù Weekly Updates</h3><div class="no-data">No data available</div></div>';
                return;
            }
            
            let html = `
                <div class="team-section">
                    <h3>üìù Weekly Updates</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Team</th>
                                <th>Update</th>
                                <th>Impact</th>
                                <th>Next Steps</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                html += `
                    <tr>
                        <td>${formatDate(row.Date)}</td>
                        <td><strong>${row.Team || ''}</strong></td>
                        <td>${row.Update || ''}</td>
                        <td>${row.Impact || ''}</td>
                        <td>${row['Next Steps'] || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ==================== INITIALIZE ====================
        initDates();
        applyFilters();
        loadAllData();
        
        // Auto-refresh every 5 minutes
        setInterval(loadAllData, 5 * 60 * 1000);
        
        // Manual refresh
        function refreshData() {
            const currentTab = document.querySelector('.tab.active').getAttribute('onclick').match(/'([^']+)'/)[1];
            document.getElementById('filterInfo').textContent = 'Refreshing...';
            loadAllData().then(() => {
                showTab(currentTab);
                document.getElementById('filterInfo').textContent = 'Data refreshed at ' + new Date().toLocaleTimeString();
            });
        }
    </script>
</body>
</html>
